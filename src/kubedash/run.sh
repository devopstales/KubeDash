#!/bin/bash

export FLASK_DEBUG=1
export TEMPLATES_AUTO_RELOAD=1
export FLASK_DEBUG=1
export TEMPLATES_AUTO_RELOAD=1
#export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
#export FLASK_CONFIG="production" # redirect to https
#export FLASK_CONFIG="production" # redirect to https
export FLASK_APP="kubedash"

export OIDC_ISSUER_URL="https://sso.shiwaforce.com/auth/realms/shiwaforce"
export OIDC_CLIENT_ID="cl03-dashboard-proxy"
export OIDC_SECRET="df4c4725-98c9-4e92-bcb1-3c761d5adc3f"
export OIDC_SCOPE="groups email openid profile good-service"
export OIDC_CALLBACK_URL="http://127.0.0.1:8000"

export K8S_CLUSTER_NAME="k8s-poc"
export K8S_API_SERVER="https://192.168.101.1:8443"
export K8S_API_CA="LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EY3hOREV6TlRJMU9Gb1hEVE16TURjeE1URXpOVEkxT0Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTStCCm5YcHNvWnZKOWlkeHcvZmZRWEdEaER3SUh1cFVFVEdxcmdBei9DdFZtY015aWJ5RXkyMllnbklhbmxDVXN1M0cKcU83ek4wYng0R0ZzOTRNYlhWWjNnWnlZZ0szd3o2UG12WXY4SThCN2xNSFJRSlc5bUhZQmJFS3NsWkdIemQ5YgpGK2RTMVhqc216V25JbnhZUEFYK1prT1hxaCt3b3VZWHZiZjF3SHh4c000YnBRN1JpWjRrcDZjZGtYZkhSbkpxCjlOT1VQTXpYNmswd2tYTDg4TFRPRVNMTE5peHJXSUcxRkY2T2RRL1pKVEVUdjR4VUUrcU9TczRRWTNlSk5OMmwKc2dqM1lEOHY2YUVTTG5jbzlmaDlBcHlMTGNpWmdqZDEyNDFXQk5tMks3V3kwRkN4U1pjQWsxYjkwei9SMUw1eQp1THJMTk0wY2J6U1UzOTVoNStrQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZJRm56S2o1Z0NFVmRpTHlndDFLdjdwSEYxeXBNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTTlMU2wrUzVHaUFBdkZtcXhvbwoxYkZ3OENyRmZzMG5tanI5YklQbzRiR0g2QmZ0UlB0NytiVjFTdE9senl4T1V2QjVIQkh4WkxkdlRvSGhHNUg5CjI2Njh4N01oQVhzS0wyUUEyeUhucmxocWRHL1dUdGFyOUluSklNbElNQmQ1eEx1M2lyeUcyVXcxcXdIbkkvUi8KTUtqWTBsQUMzTjdLbk9IMjlxUGZIQTNidk5LMUFWb29wZmZDM0dER0QrRXJHWTh5VnJ4T0M4aDM0NDdPWWwyZgppUnhCMG16dnZCa3p1YU1hUnQwYzdYN2JwcDB5RVp3NGd4Mk8wdzBFbE05Tmw0OE1PcFVyTURMSWZtQ2hTYkZyCi9pUDZaMVZ3RjZBMjBiVVVoenduMnQzTGxQRUwwQWFGNWkrTk9UYy9rczNjRDhQcWpZN1pCWkdReTNCTDlnSzMKZWdNPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="

export EXTERNAL_DATABASE_ENABLED=True
# EXTERNAL_DATABASE_HOST
# EXTERNAL_DATABASE_DB
# EXTERNAL_DATABASE_USER
export EXTERNAL_DATABASE_PASSWORD="kubedash"

USER=$(id -u)
echo "Setting USER environment variable to ${USER}"
export USER=$USER

echo "Start Migration"
flask db upgrade

mkdir -p /tmp/kubedash

echo "Start Gunicorn"
flask run --host=127.0.0.1 --port=8000
#python3 kubedash.py
#gunicorn --worker-class eventlet --conf gunicorn_conf.py kubedash:app
