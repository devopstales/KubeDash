#!/bin/bash

export FLASK_DEBUG=1
export TEMPLATES_AUTO_RELOAD=1
export FLASK_DEBUG=1
export TEMPLATES_AUTO_RELOAD=1
#export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
#export FLASK_CONFIG="production" # redirect to https
#export FLASK_CONFIG="production" # redirect to https
export FLASK_APP="kubedash"

export OIDC_ISSUER_URL="https://sso.shiwaforce.com/auth/realms/shiwaforce"
export OIDC_CLIENT_ID="cl03-dashboard-proxy"
export OIDC_SECRET="df4c4725-98c9-4e92-bcb1-3c761d5adc3f"
export OIDC_SCOPE="groups email openid profile good-service"
export OIDC_CALLBACK_URL="http://127.0.0.1:8000"

export K8S_CLUSTER_NAME="k8s-poc"
export K8S_API_SERVER="https://192.168.101.1:8443"
export K8S_API_CA="LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJZUoyc0hYeXlQMHd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBNU1UTXdPVEUzTkRaYUZ3MHpNekE1TVRBd09USXlORFphTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN5cDNCaUNPUVhva1lrdmVBL1NwRXlnaEZXeXR6TnViVlV2Nkl1bWNoaHpuY1F4U0FselhYcEdPaW4KOTBGUngzNEpkUzFTdkR1cGM4STg5OWNnZGFOdllWUkFFd1NsSXlRSHkxNTJoSTBQUlVyMjY0ZWpVN01KcnFGNgpMUTg2eWdHRTdpV2NsNStsZkgvN2dNUEZUN3lqUU10RGViMVdvc0NiaUM5UHQ1WEcwZzFrRVFNb2JiemdUejhqCmc1YjhySW0wQyswK1dCV0c4ZlhTQXFwc3JPVDBhbzdKS1lVYmhCN3FnemRLRFRRL2tLWi9yU29UZE9XYUFLTGUKSnBQZnkyNUpjTjdBYkZsNG5IT0l0am45UVo4VlFNTkQ3UjJKWnRsU3AwdG95aUU0OGlJbTRNbnN1QlcycGJjQwpPR091M3R1VW5YQnJ6SUZuM1ZuOEIvL1NFVVVmQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJSMXZyLzdWdGN5aVlvTkV1RDIyUlhGYWQ2T296QVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQndkalFiOW9iQQpuZk9qMXhaN3F4K2tNMVprUW9Sb1YvbGx3SmtZN05hdXNpMXNKM2FweERYdDEyQmMrSGFaRElCanVnb1VpV242CmFwOWp3VjN5cWNNSWFoMFZlTFg4TXJVY1JhekVFSHhZMVNhTGwrTDZOeS91WHNzUmJ4ZDlBTWR3Q0NrbGpZM2kKVjU2Z2liT3VRUFZGUDVxc0Z1OTNzNkpQODhUQ0F5Z280WEVzcjQrb0tZSDAwWll3b1B6Sjc4TCszQXprbmVPVgpXeVlpUlE2ZHVUYlFHTXhRTGw3SHBBbktRT0gyUUltU2ZNNHg0c055MktQeHc2NlRNR0ZHWnlMdkdpbUFLeXBPCllGNHJGZWhiTTM3eFJLdFRVSFUvaEp0NGg4RmhmK0hWUE52eHZaNVZnTVpmS0Q4UmdYTCtPWXNwQVhqK3NCdzkKSEhCSllCcFlORm1LCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"

export EXTERNAL_DATABASE_ENABLED=False
# EXTERNAL_DATABASE_HOST
# EXTERNAL_DATABASE_DB
# EXTERNAL_DATABASE_USER
export EXTERNAL_DATABASE_PASSWORD="kubedash"

USER=$(id -u)
echo "Setting USER environment variable to ${USER}"
export USER=$USER

echo "Start Migration"
flask db upgrade

mkdir -p /tmp/kubedash

echo "Start Aplication"
flask run --host=127.0.0.1 --port=8000
#python3 kubedash.py
#gunicorn --worker-class eventlet --conf gunicorn_conf.py kubedash:app
