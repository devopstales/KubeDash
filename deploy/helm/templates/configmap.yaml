---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kubedash.fullname" . }}-kubedash-ini
  labels:
    app: kubedash
    {{ include "kubedash.labels" . | nindent 4 }}
data:
  kubedash.ini: |-
    ##################### KubeDash Configuration Defaults #####################
    [DEFAULT]
    app_mode = production

    #################################### Database ############################
    [database]
    {{ if .Values.externalDatabase.enabled }}
    type = postgres
    host = {{ .Values.externalDatabase.host }}
    name = {{ .Values.externalDatabase.database }}
    user = root
    password = {{ .Values.externalDatabase.password | b64enc }}
    {{ else if .Values.postgresqlHa.enabled }}
    type = postgres
    host = {{ .Release.Name }}-pgpool
    name = {{ .Values.postgresqlHa.postgresql.database }}
    user = root
    password = {{ .Values.postgresqlHa.postgresql.password | b64enc }}
    {{ else }}
    type = sqlite3
    {{ end }}

    {{ if .Values.oidc.enabled }}
    #################################### SSO Settings ###########################
    [sso_settings]

    issuer_url = {{ .Values.oidc.provider.oidcUrl}}

    client_id = {{ .Values.oidc.provider.oidcClientId }}

    secret = {{ .Values.oidc.provider.oidcSecret }}

    scope = {{ .Values.oidc.provider.oidcScopes}}

    {{ if .Values.ingress.tls.enabled }}
    callback_url = https://{{ .Values.ingress.url }}
    {{ else }}
    callback_url = http://{{ .Values.ingress.url }}
    {{ end }}
    {{ end }}
    #################################### K8S ###########################
    [k8s]
    cluster_name = {{ .Values.cluster.name }}
    api_server = {{ .Values.cluster.apiUrl }}
    {{ if .Values.cluster.caCert }}
    api_ca = {{ .Values.cluster.caCert | b64enc }}
    {{ end }}

    #################################### Plugin Settings ###########################
    [plugin_settings]
    registry = true
    helm = true
    gateway_api = true
    cert_manager = true